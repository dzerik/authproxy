# Сценарии администрирования

Данный документ содержит названия переменных, одинаково применимых для различных сред контейнеризации, указанных в системных требованиях.
Имя переменной **не определяет** конкретную среду контейнеризации.

---

## Введение

Раздел содержит описание сценариев администрирования **IAM Proxy**.

---

## Варианты администрирования

Администрирование IAM Proxy осуществляется путём изменения конфигурации **тремя способами**:

1. **Администрирование с использованием компонента **
   *(данный способ является целевым)*

2. **Администрирование с использованием YAML-файла конфигурации формата **
   Процесс описан в разделе
   *«Администрирование с помощью компонента »*

3. **Администрирование с использованием YAML-файла inventory-ansible**
   Применяется при установке с помощью Ansible.
   Подходит для версий IAM Proxy без развернутого **RDS-Server**.
   Процесс установки описан в разделе *«Установка»*.

---

## Администрирование с использованием компонента 

Компонент **** — это централизованный инструмент управления параметрами и конфигурациями.

Он используется для изменения конфигурации **без повторного развертывания**.

Для администрирования с использованием компонента  необходимо руководствоваться разделом
*«Администрирование с помощью компонента »*.

---

## Типовые сценарии администрирования IAM Proxy

Типовые сценарии:

* Добавление / удаление / изменение ответвлений (junction)
* Контроль событий системного журнала
  *(описан в разделе «События системного журнала»)*
* Контроль событий мониторинга
  *(описан в разделе «События мониторинга»)*

---

## Добавление нового ответвления (junction)

Для создания нового ответвления используйте один из способов ниже.

### Использование YAML-файла 

1. Отредактируйте YAML-файл конфигурации IAM Proxy
2. Добавьте новую секцию `JunctionConfig`
3. Заполните параметры
4. При необходимости — добавьте секцию `Junction` для соответствующих зон

---

## Изменение параметров ответвления (junction)


### Использование YAML-файла 

1. Отредактируйте YAML-файл конфигурации
2. Найдите нужное ответвление в `JunctionConfig`
3. Измените необходимые параметры

---

## Удаление ответвления (junction)



### Использование YAML-файла 

1. Отредактируйте YAML-файл конфигурации
2. Удалите секцию соответствующего `JunctionConfig`
3. При наличии нескольких зон — удалите ответвление во всех зонах

---

# Параметры настройки

## Примечание

Раздел содержит описание параметров конфигурационного файла IAM Proxy.

---

## Группа `ZoneConfig`

Содержит **основные параметры конфигурации IAM Proxy**.

---

## Группа `JunctionConfig`

Группа основных параметров ответвления **junction**.

* Название ответвления отображается **только на стартовой странице IAM Proxy**
* Допускается группировка ответвлений для визуального упорядочивания
* Группировка **не влияет** на процесс проксирования

### Пример группировки

```
Группа ответвлений/мое ответвление
```

На стартовой странице появится группа **«Группа ответвлений»**, внутри которой — *«мое ответвление»*.

---

### Параметры `JunctionConfig`

| Параметр                | Значение по умолчанию | Описание                                                    | Пример                                         |
| ----------------------- | --------------------- | ----------------------------------------------------------- | ---------------------------------------------- |
| `junctionName`          | —                     | Название ответвления (с возможностью группировки через `/`) | Контур "Компания"/Администрирование            |
| `description`           | —                     | Описание ответвления (только UI)                            | Страница администрирования                     |
| `junctionPoint` *       | —                     | Контекст URL ответвления (`/` — корень)                     | `/company`                                     |
| `indexUrl`              | —                     | URL перехода со стартовой страницы                          | `/admin`                                       |
| `transparent` *         | `False`               | Прозрачность URL при проксировании                          | `True`                                         |
| `https` *               | `True`                | Использование SSL для backend                               | `False`                                        |
| `sslCommonName`         | `.mycompany.ru`       | CN сертификата backend                                      | `.ourcompany.ru`                               |
| `serverAddresses[]`     | —                     | Список backend-серверов                                     | `10.X.X.1:9443`                                |
| `applyJctRequestFilter` | —                     | Фильтры для junction                                        | `common/set-authz-by-role-admin.location.conf` |

***** — обязательный параметр при ручном создании конфигурации.

Полный список фильтров — в разделе
*«Файлы дополнительных опций для ответвлений»*.

---

## Группа `ZoneConfig` (standIn / offline)

### Параметры зон

| Параметр            | Значение по умолчанию | Описание         | Пример  |
| ------------------- | --------------------- | ---------------- | ------- |
| `zoneNameStandin` * | `standin`             | Имя зоны StandIn | `zone1` |
| `zoneNameOffline` * | `offline`             | Имя зоны offline | `zone2` |

---

## Группа `ZoneConfig/Zone`

Настройки конкретной зоны.

| Параметр               | Значение по умолчанию | Описание                        | Пример                                           |
| ---------------------- | --------------------- | ------------------------------- | ------------------------------------------------ |
| `applyRequestFilter` * | —                     | Фильтр для всех junction в зоне | `common/rewrite-response-is-offline.server.conf` |

---

## Группа `ZoneConfig/Zone[]/Junction[]`

Настройки конкретного ответвления в зоне.

| Параметр            | Значение по умолчанию | Описание                         | Пример                    |
| ------------------- | --------------------- | -------------------------------- | ------------------------- |
| `serverAddresses[]` | —                     | Backend endpoints (адрес[:порт]) | `abs-5.mycompany.ru:4444` |

---

## Параметры в корневом контексте (RDS-Server)

| Параметр                        | Значение по умолчанию | Описание                    | Пример |
| ------------------------------- | --------------------- | --------------------------- | ------ |
| `checkConfigurationFrequency` * | `60`                  | Проверка конфигурации (сек) | `1`    |
| `checkStandInFrequency` *       | `10`                  | Проверка StandIn (сек)      | `35`   |
| `httpClientMaxPoolSize` *       | `1`                   | Размер пула HTTP-клиента    | `10`   |
| `manualMode` *                  | `false`               | Ручное переключение контура | `true` |
| `transportRequestTimeout` *     | `9`                   | Таймаут ответа ММТ (сек)    | `15`   |
| `usePlatformSemaphore` *        | `false`               | Тип семафора                | `true` |

---
