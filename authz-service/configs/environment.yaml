# Environment Configuration (Static - requires restart to change)
# This file contains server configuration, logging, and config source settings.

# Environment information
env:
  name: development
  region: local
  cluster: local
  version: "1.0.0"
  features: {}
  custom: {}

# HTTP/gRPC Server configuration (static - requires restart)
server:
  http:
    enabled: true
    addr: ":8080"
    read_timeout: 10s
    write_timeout: 30s
    idle_timeout: 120s
    shutdown_timeout: 30s
    max_header_bytes: 1048576  # 1MB
  grpc:
    enabled: false
    addr: ":9090"
    max_recv_msg_size: 4194304  # 4MB
    max_send_msg_size: 4194304
    keepalive:
      time: 30s
      timeout: 10s

# Management server configuration (Istio-style admin ports)
management:
  enabled: true
  # Admin interface for config_dump, stats, logging, runtime
  admin_addr: ":15000"
  # Aggregated health/metrics endpoint
  health_addr: ":15020"
  # Dedicated readiness probe endpoint
  ready_addr: ":15021"

# Logging configuration (static - requires restart)
logging:
  level: info
  format: json
  output: stdout
  add_caller: true

# Tracing configuration (static - requires restart)
tracing:
  enabled: false
  endpoint: "localhost:4317"
  insecure: true
  service_name: "authz-service"
  service_version: ""
  environment: "development"
  sample_rate: 1.0
  batch_timeout: "5s"
  export_timeout: "30s"
  propagate_headers: true

# Configuration source settings
config_source:
  # Source type: file, remote, or hybrid
  type: file

  # File-based configuration source
  file:
    services_path: "/etc/authz/services.yaml"
    rules_path: "/etc/authz/rules.yaml"
    watch_enabled: true

  # Remote configuration service (for type: remote or hybrid)
  remote:
    endpoint: ""
    auth:
      type: none
      # client_cert: ""
      # client_key: ""
      # ca_cert: ""
      # token: ""
      # token_file: ""
    paths:
      services: "/api/v1/configs/authz/services"
      rules: "/api/v1/configs/authz/rules"
    polling:
      enabled: true
      interval: 30s
      timeout: 10s
      retry:
        max_attempts: 3
        backoff: 1s
        max_backoff: 30s
    push:
      enabled: false
      type: sse

  # Fallback when remote is unavailable
  fallback:
    enabled: true
    cache_path: "/var/cache/authz/"
    max_age: 1h
