ВАЖНО: этот файл предназначен для описания тестовых сценариев и необходимых зависимостей для полноценного тестирования Authz Service в различных условиях и конфигурациях.
ИСПОЛЬЗУЙТЕ ЕГО КАК ШАБЛОН ДЛЯ РАЗРАБОТКИ И АВТОМАТИЗАЦИИ ТЕСТОВЫХ
ИСПОЛЬЗОВАТЬ DOCKER, не popdman

сценарии тестирования

# Сценарии тестирования для Authz Service
сценарий тестирования пользовательского пути
1. пользовчатель обращается к защищенному ресурсу, если нет токена, получает 401 Unauthorized
2. пользователь аутентифицируется в Keycloak, получает JWT токен
3. пользователь обращается к защищенному ресурсу с валидным токеном, получает 200 OK
4. пользователь обращается к защищенному ресурсу с истекшим токеном, получает 401 Unauthorized
5. пользователь обращается к защищенному ресурсу с токеном, не имеющим нужных прав, получает 403 Forbidden
6. пользователь обращается к защищенному ресурсу с токеном, имеющим нужные права, получает 200 OK
7. проверка логирования успешных и неуспешных попыток доступа
8. проверка метрик доступа и отказов
9. проверка работы кэширования JWT ключей в Redis
10. проверка отказоустойчивости при недоступности Keycloak
11. проверка масштабируемости при увеличении количества запросов
12. проверка интеграции с OPA для сложных политик авторизации
13. Реализованв 2 сценария авторизации через встроенный движок и через OPA
14. проверка работы mTLS между сервисами в Istio
15. проверка применения сетевых политик Cilium
16. проверка трассировки запросов через Jaeger
17. проверка работы с различными типами токенов (RS256, HS256)
18. проверка обновления политик авторизации без перезапуска сервиса
19. проверка работы в различных средах (локальная, staging, production)
20. проверка совместимости с различными версиями Kubernetes и k3s

где использовать приложение authz-service в сценариях тестирования
- аутентификация и авторизация пользователей
- интеграция с Keycloak для управления пользователями и ролями
- прилодение как входящай обратный прокси для всего неймспейса
- приложение как sidecar для микросервисов
- приложение как егрес прокси с авторизацией внешних интеграций (mtls + jwt)
- приложение как егрес прокси с авторизацией внешних интеграций (mtls + jwt) с этим же приложением на стороне внешней системы
- приложение как централизованный сервис авторизации (не прокси)
- проверка доступа к микросервисам на основе JWT токенов
- провпка прокидываявания дааных пользователя в заголовках для транзитивных запросов
- проверка работы с различными политиками авторизации (RBAC, ABAC)

итого что какаее заглушки нужны и сервисы нужны
1. Keycloak - для аутентификации и выдачи JWT токенов, с необходимыми realm, client и пользователями с автоматическим созданием через kcadm.sh\
2. Redis - для кэширования публичных ключей JWT и других данных, с безопасной конфигурацией
3. WireMock - для имитации внешних сервисов (2 экземпляра внутри кластера (allow for user and allow only for admins  ) и 1 внешний data layer)
4. OPA - для сложных политик авторизации
5. Prometheus - для сбора метрик
6. Grafana - для визуализации метрик
7. Jaeger - для трассировки запросов
8. PostgreSQL - для хранения данных Keycloak
9. K8s Cluster (k3s) - для развёртывания всех компонентов
10. Istio - для обеспечения mTLS и сетевых политик и проверки совместимости и работы сервиса в mesh
11. Cilium - для реализации сетевых политик на уровне eBPF и проверки совместимости и работы сервиса с Cilium
12. Nginx или Traefik - для управления входящим трафиком (Ingress)
13. Mock сервисы - для имитации поведения реальных микросервисов
14. CI/CD система - для автоматизации тестирования и развёртывания
15. Helm - для управления пакетами в Kubernetes
16. Kustomize - для управления конфигурациями Kubernetes
17. Локальная среда разработки - для быстрого тестирования и отладки
18. podman compose - для локального развёртывания зависимостей без k3s
19. тестирование интеграции istio и cilium в одном кластере c целью проверки совместимости и взаимодействия между ними
20. реализация UI для авторизации через keycloak и получения токенов для тестирования пользовательских сценариев


скрипыт для развёртывания стендов
1. K8S чистильный кластер (k3s), без istio и cilium, 
2. K8S с istio
3. K8S с cilium
4. K8S с istio и cilium
5. локальная среда с podman compose
6. скрипты для развёртывания и полной очистки зависимостей: keycloak, redis, wiremock, opa, prometheus, grafana, jaeger только в compose
7. подобрать сервис и скрипты для работы с сертиификатами 